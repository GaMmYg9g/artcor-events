<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtCor-Events</title>
    <meta name="description" content="App para gestiÃ³n de eventos y asistencia de integrantes">
    <meta name="theme-color" content="#ff5a8c">
    
    <!-- PWA Manifest - RUTA ABSOLUTA -->
    <link rel="manifest" href="/artcor-events/manifest.json">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ArtCor Events">
    
    <!-- Iconos - RUTAS ABSOLUTAS -->
    <link rel="icon" href="/icon-192x192.png" type="image/png">
    <link rel="apple-touch-icon" href="/icon-192x192.png">
    <link rel="icon" href="/icon-144x144.png" type="image/png">
    <!-- Estilos - RUTA ABSOLUTA -->
    <link rel="stylesheet" href="/artcor-events/style.css">
    <link rel="manifest" href="/artcor-events/manifest.json?v=2">
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Registro del Service Worker -->
    <script>
        // Registrar Service Worker cuando la pÃ¡gina cargue
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/artcor-events/sw.js', {
                    scope: '/artcor-events/'
                }).then(function(registration) {
                    console.log('ServiceWorker registrado exitosamente con scope: ', registration.scope);
                    
                    // Verificar actualizaciones
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        console.log('Nueva versiÃ³n del Service Worker encontrada');
                        
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    // Nueva versiÃ³n disponible
                                    console.log('Nueva versiÃ³n disponible. Mostrando notificaciÃ³n...');
                                    if (confirm('Â¡Nueva versiÃ³n disponible! Â¿Recargar para actualizar?')) {
                                        window.location.reload();
                                    }
                                }
                            }
                        });
                    });
                }).catch(function(error) {
                    console.log('Error al registrar ServiceWorker: ', error);
                });
            });
        }
    </script>
</head>
<body>
    <!-- MenÃº lateral estilo WhatsApp -->
    <div class="side-menu" id="sideMenu">
        <div class="menu-header">
            <div class="menu-avatar">AC</div>
            <h2>ArtCor-Events</h2>
            <button class="close-menu" id="closeMenu">Ã—</button>
        </div>
        
        <div class="menu-items">
            <div class="menu-section">
                <h3>Eventos</h3>
                <div class="event-tree" id="eventTree">
                    <!-- Los eventos se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                </div>
            </div>
            
            <div class="menu-section">
                <h3>Miembros</h3>
                <button class="menu-btn" id="manageMembers">
                    <span>Gestionar Miembros</span>
                    <span>â†’</span>
                </button>
            </div>
            
            <div class="menu-section">
                <h3>Asistencia</h3>
                <button class="menu-btn" id="viewAttendance">
                    <span>Ver Asistencia</span>
                    <span>â†’</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Overlay para el menÃº -->
    <div class="menu-overlay" id="menuOverlay"></div>
    
    <!-- Encabezado principal -->
    <header class="app-header">
        <button class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <h1>ArtCor-Events</h1>
        <button class="add-btn" id="addEventBtn">+</button>
    </header>
    
    <!-- Contenido principal -->
    <main class="main-content">
        <!-- Vista de inicio -->
        <section class="welcome-section" id="welcomeSection">
            <div class="welcome-card">
                <div class="welcome-icon">ðŸŽ¤</div>
                <h2>Bienvenida a ArtCor-Events, Alexandra</h2>
                <p>Esta aplicaciÃ³n te ayudarÃ¡ a gestionar los eventos y llevar el control de asistencia de los miembros del proyecto ArtCor.</p>
                <div class="feature-list">
                    <div class="feature">
                        <span>âœ“</span>
                        <p>Registra eventos con fecha y participantes</p>
                    </div>
                    <div class="feature">
                        <span>âœ“</span>
                        <p>Gestiona la base de datos de miembros</p>
                    </div>
                    <div class="feature">
                        <span>âœ“</span>
                        <p>Visualiza estadÃ­sticas de asistencia</p>
                    </div>
                    <div class="feature">
                        <span>âœ“</span>
                        <p>Organiza eventos por aÃ±o, mes y dÃ­a</p>
                    </div>
                </div>
                <p class="hint">Toca <strong>âž•</strong> para crear un nuevo evento</p>
            </div>
        </section>
        
        <!-- Lista de eventos -->
        <section class="events-section" id="eventsSection" style="display: none;">
            <h2>Eventos Recientes</h2>
            <div class="events-list" id="eventsList">
                <!-- Los eventos se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
            </div>
        </section>
    </main>
    
    <!-- Modal para crear/editar evento -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nuevo Evento</h2>
                <button class="close-modal" id="closeModal">Ã—</button>
            </div>
            <form id="eventForm">
                <div class="form-group">
                    <label for="eventName">Nombre del Evento</label>
                    <input type="text" id="eventName" placeholder="Ej: Ensayo General" required>
                </div>
                
                <div class="form-group">
                    <label for="eventDate">Fecha</label>
                    <input type="date" id="eventDate" required>
                </div>
                
                <div class="form-group">
                    <label>Miembros que Asistieron</label>
                    <div class="members-checklist" id="membersChecklist">
                        <!-- Los integrantes se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn cancel-btn" id="cancelEvent">Cancelar</button>
                    <button type="submit" class="btn save-btn">Guardar Evento</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal para gestionar integrantes -->
    <div class="modal" id="membersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gestionar Miembros</h2>
                <button class="close-modal" id="closeMembersModal">Ã—</button>
            </div>
            
            <div class="members-management">
                <form id="addMemberForm">
                    <div class="form-row">
                        <input type="text" id="memberName" placeholder="Nombre del integrante" required>
                        <input type="text" id="memberRole" placeholder="Rol (Ej: Vocalista)" required>
                        <button type="submit" class="btn add-member-btn">Agregar</button>
                    </div>
                </form>
                
                <div class="members-list" id="membersList">
                    <!-- Los integrantes se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para ver asistencia -->
    <div class="modal" id="attendanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>EstadÃ­sticas de Asistencia</h2>
                <button class="close-modal" id="closeAttendanceModal">Ã—</button>
            </div>
            
            <div class="attendance-stats">
                <div class="stats-filters">
                    <button class="filter-btn active" data-filter="all">General</button>
                    <button class="filter-btn" data-filter="year">Por AÃ±o</button>
                    <button class="filter-btn" data-filter="month">Por Mes</button>
                </div>
                
                <div class="stats-content" id="statsContent">
                    <!-- Las estadÃ­sticas se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts - RUTA ABSOLUTA -->
    <script src="/artcor-events/app.js"></script>
    
    <!-- Script para detecciÃ³n de PWA instalada -->
    <script>
        // Detectar si la PWA estÃ¡ instalada
        window.addEventListener('DOMContentLoaded', function() {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('PWA instalada y ejecutÃ¡ndose en modo standalone');
                document.body.classList.add('pwa-installed');
            }
            
            // Verificar que estamos en la ruta correcta
            if (!window.location.pathname.includes('artcor-events')) {
                console.warn('La PWA no estÃ¡ en la ruta correcta. Redirigiendo...');
                window.location.href = '/artcor-events/';
            }
        });


// Forzar limpieza al cargar
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    for(let registration of registrations) {
                        registration.unregister();
                    }
                }),

    
    // Limpiar caches
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    cacheNames.forEach(cacheName => {
                        caches.delete(cacheName);
                    });
                });
            }
        }
        </script>
</body>
</html>
